<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KB åˆ†æä¸­æ¨ (æ——è‰¦å­¸è¡“ç‰ˆ) | Teacher Dashboard v20.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        
        /* Card & Layout */
        .card { background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.2s; position: relative; display: flex; flex-direction: column; }
        .card:hover { box-shadow: 0 4px 6px rgba(0,0,0,0.05); transform: translateY(-1px); }
        
        /* Navigation */
        .nav-item.active { background-color: #0f172a; color: white; border-left: 4px solid #3b82f6; }
        .kb-badge { font-size: 0.75rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 600; }
        .section-view { display: none; opacity: 0; transition: opacity 0.3s ease-in; }
        .section-view.active { display: block; opacity: 1; }
        .student-item.active-student { background-color: #e0e7ff; border-color: #818cf8; }

        /* Ref Button Style */
        .ref-btn {
            font-size: 0.75rem; color: #64748b; cursor: pointer; display: inline-flex; align-items: center;
            background: #f8fafc; padding: 4px 10px; border-radius: 9999px; border: 1px solid #cbd5e1;
            transition: all 0.2s;
        }
        .ref-btn:hover { background: #e0f2fe; color: #0284c7; border-color: #7dd3fc; }
        .ref-btn i { margin-right: 4px; font-size: 0.7rem; }

        /* Modal Styles - Enhanced for Longer Content */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6);
            display: flex; justify-content: center; align-items: center; z-index: 100;
            opacity: 0; visibility: hidden; transition: all 0.3s; backdrop-filter: blur(2px);
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal-content {
            background: white; width: 95%; max-width: 700px; border-radius: 16px; padding: 0;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: translateY(20px); transition: all 0.3s; overflow: hidden; max-height: 85vh; display: flex; flex-direction: column;
        }
        .modal-overlay.open .modal-content { transform: translateY(0); }
        .modal-header { background: #f8fafc; padding: 20px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 24px; font-size: 0.95rem; line-height: 1.7; color: #334155; overflow-y: auto; flex-grow: 1; }
        .modal-cite { margin-top: 24px; padding: 16px; border-top: 1px solid #e2e8f0; font-size: 0.8rem; color: #64748b; background: #f1f5f9; border-radius: 8px; }
        .result-box { background-color: #f0fdf4; border-left: 4px solid #22c55e; padding: 16px; margin: 16px 0; border-radius: 4px; }
        .result-title { font-weight: 700; color: #166534; margin-bottom: 8px; display: flex; align-items: center; font-size: 0.9rem; }
        
        /* Timeline & Hotspot */
        .timeline-line { position: absolute; left: 28px; top: 10px; bottom: 10px; width: 2px; background: #cbd5e1; z-index: 0; }
        @keyframes pulse-dot { 
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0px rgba(255, 255, 255, 0.7); } 
            50% { transform: scale(1.3); opacity: 0.8; box-shadow: 0 0 0 4px rgba(255, 255, 255, 0); } 
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0px rgba(255, 255, 255, 0); } 
        }
        .hotspot-dot { animation: pulse-dot 2s infinite ease-in-out; }

        /* Lens & Legend */
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 4px; }
        .dot-fact { background-color: #cbd5e1; } .dot-theory { background-color: #3b82f6; }
        .dot-challenge { background-color: #eab308; } .dot-synthesis { background-color: #22c55e; }
        .lens-detail-box { background: #f8fafc; border-left: 4px solid #94a3b8; padding: 16px; border-radius: 0 8px 8px 0; min-height: 120px; font-size: 0.9rem; transition: all 0.3s; }
        .lens-detail-title { font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; font-size: 1rem; }
        .example-quote { background: rgba(255,255,255,0.6); padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 0.85rem; font-style: italic; border: 1px dashed rgba(0,0,0,0.1); }
        .example-author { font-weight: bold; font-style: normal; color: #475569; font-size: 0.75rem; }
    </style>
</head>
<body class="h-screen overflow-hidden flex">

    <!-- Ref Modal -->
    <div id="ref-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-title" class="text-lg font-bold text-slate-800 flex items-center"><i class="fas fa-microscope text-blue-500 mr-2"></i> åˆ†æè©³è§£</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <h4 class="font-bold text-xs text-blue-600 uppercase mb-3 tracking-widest"><i class="fas fa-graduation-cap mr-2"></i> çŸ¥è­˜å»ºæ§‹ç†è«–èƒŒæ™¯ (KB Theoretical Framework)</h4>
                    <div id="modal-desc" class="text-slate-700 leading-relaxed text-sm">...</div>
                </div>
                <div class="result-box">
                    <div class="result-title"><i class="fas fa-chart-line mr-2"></i> ğŸ’¡ æ•¸æ“šè¨ºæ–·èˆ‡æ•™å­¸å°å¼• (Data-Driven Insight)</div>
                    <div id="modal-analysis" class="text-sm text-slate-700 space-y-2">...</div>
                </div>
                <div class="modal-cite">
                    <strong class="block text-[10px] font-bold text-slate-500 uppercase mb-2 tracking-tighter">ğŸ“š å­¸è¡“åƒè€ƒä¾†æº (Academic References)</strong>
                    <span id="modal-ref" class="block leading-snug">...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar (Same as before) -->
    <aside class="w-64 bg-slate-900 text-slate-400 flex flex-col shadow-2xl z-20 flex-shrink-0">
        <div class="p-6 border-b border-slate-800">
            <h1 class="text-xl font-bold tracking-wider text-white flex items-center"><i class="fas fa-network-wired mr-2 text-blue-500"></i> KB ANALYTICS</h1>
            <p class="text-xs text-slate-500 mt-1 ml-6">v20.1 Fixed</p>
        </div>
        <nav class="mt-6 flex-1 px-2 space-y-1">
            <button onclick="switchView('overview')" id="nav-overview" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-r-lg hover:bg-slate-800 transition text-left"><i class="fas fa-tachometer-alt w-5"></i><span>ç¸½é«”æ¦‚æ³ (Overview)</span></button>
            <button onclick="switchView('students')" id="nav-students" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-r-lg hover:bg-slate-800 transition text-left"><i class="fas fa-users w-5"></i><span>å€‹åˆ¥å­¸ç”Ÿ (Students)</span></button>
            <button onclick="switchView('topics')" id="nav-topics" class="nav-item active w-full flex items-center space-x-3 px-4 py-3 rounded-r-lg hover:bg-slate-800 transition text-left"><i class="fas fa-lightbulb w-5"></i><span>ä¸»é¡Œèˆ‡è§€é» (Ideas)</span></button>
            <button onclick="switchView('quality')" id="nav-quality" class="nav-item w-full flex items-center space-x-3 px-4 py-3 rounded-r-lg hover:bg-slate-800 transition text-left"><i class="fas fa-microscope w-5"></i><span>è¨€è«‡å“è³ª (Quality)</span></button>
        </nav>
        <div class="p-4 bg-slate-950 border-t border-slate-800 text-xs text-slate-500">System Status: <span class="text-green-500">All Modules Active</span></div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 bg-slate-50 p-8 overflow-y-auto relative">

        <!-- ========================================= -->
        <!-- VIEW 1: ç¸½é«”æ¦‚æ³ (Overview) -->
        <!-- ========================================= -->
        <div id="view-overview" class="section-view space-y-6">
            <header class="flex justify-between items-center">
                <div><h2 class="text-2xl font-bold text-slate-800">ç­ç´šç¤¾ç¾¤è„ˆå‹•</h2><p class="text-sm text-slate-500">å…¨ç­çŸ¥è­˜å»ºæ§‹ç‹€æ…‹èˆ‡é›†é«”è²¬ä»»æŒ‡æ¨™</p></div>
                <div class="flex gap-3"><span class="bg-white px-3 py-1 rounded-full text-xs border border-slate-200 shadow-sm flex items-center"><i class="fas fa-calendar-alt mr-2 text-slate-400"></i> Week 5</span></div>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="card border-l-4 border-green-500">
                    <div class="flex justify-between items-start"><div><div class="text-xs text-slate-500 font-bold uppercase">çŸ¥è­˜æ°‘ä¸»åŒ– (Gini)</div><div class="text-3xl font-bold text-slate-800 mt-1">0.21</div></div><i class="fas fa-balance-scale text-green-200 text-3xl"></i></div>
                    <div class="mt-2 text-xs text-green-600 bg-green-50 inline-block px-2 py-1 rounded"><i class="fas fa-check-circle mr-1"></i> é«˜åº¦å¹³è¡¡</div>
                    <div class="mt-auto text-right pt-2"><button class="ref-btn" onclick="openRef('gini')"><i class="fas fa-book"></i> Ref:</button></div>
                </div>
                <div class="card border-l-4 border-blue-500">
                    <div class="flex justify-between items-start"><div><div class="text-xs text-slate-500 font-bold uppercase">ç¤¾ç¾¤å¯†åº¦ (Density)</div><div class="text-3xl font-bold text-slate-800 mt-1">0.45</div></div><i class="fas fa-project-diagram text-blue-200 text-3xl"></i></div>
                    <div class="mt-2 text-xs text-slate-500">ç›®æ¨™ > 0.6</div>
                    <div class="mt-auto text-right pt-2"><button class="ref-btn" onclick="openRef('density')"><i class="fas fa-book"></i> Ref:</button></div>
                </div>
                <div class="card border-l-4 border-purple-500">
                    <div class="flex justify-between items-start"><div><div class="text-xs text-slate-500 font-bold uppercase">å¹³å‡è¨è«–æ·±åº¦</div><div class="text-3xl font-bold text-slate-800 mt-1">4.2 å±¤</div></div><i class="fas fa-layer-group text-purple-200 text-3xl"></i></div>
                    <div class="mt-2 text-xs text-purple-600 font-bold"><i class="fas fa-arrow-up mr-1"></i> +15%</div>
                    <div class="mt-auto text-right pt-2"><button class="ref-btn" onclick="openRef('depth')"><i class="fas fa-book"></i> Ref:</button></div>
                </div>
                <div class="card border-l-4 border-red-500">
                    <div class="flex justify-between items-start"><div><div class="text-xs text-slate-500 font-bold uppercase">éœ€é·¹æ¶å¼•å°</div><div class="text-3xl font-bold text-red-500 mt-1">3 äºº</div></div><i class="fas fa-exclamation-triangle text-red-200 text-3xl"></i></div>
                    <div class="mt-2 text-xs text-red-600 cursor-pointer hover:underline" onclick="switchView('students')">æŸ¥çœ‹åå–® ></div>
                    <div class="mt-auto text-right pt-2"><button class="ref-btn" onclick="openRef('risk')"><i class="fas fa-book"></i> Ref:</button></div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 card">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-800"><i class="fas fa-share-alt text-blue-500 mr-2"></i>ç¤¾ç¾¤äº’å‹•çµæ§‹ (SNA)</h3><button class="ref-btn" onclick="openRef('sna')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div id="overview-network-container" class="h-[300px] bg-slate-50 rounded border border-slate-100"></div>
                </div>
                <div class="card">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-800"><i class="fas fa-compass text-indigo-500 mr-2"></i>KB 12åŸå‰‡è½å¯¦åº¦</h3><button class="ref-btn" onclick="openRef('principles')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div class="h-[250px]"><canvas id="principlesChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: å€‹åˆ¥å­¸ç”Ÿåˆ†æ (Students) -->
        <div id="view-students" class="section-view space-y-6">
            <!-- Content remains the same as original except calling ref functions -->
            <header class="flex justify-between items-center">
                <div><h2 class="text-2xl font-bold text-slate-800">å€‹åˆ¥å­¸ç”Ÿæ·±åº¦è¨ºæ–·</h2><p class="text-sm text-slate-500">å¾®è§€åˆ†æï¼šèªçŸ¥æˆé•·èˆ‡ç¤¾äº¤çµæ§‹</p></div>
            </header>
            <div class="flex flex-col lg:flex-row gap-6 h-[calc(100vh-140px)]">
                <div class="w-full lg:w-1/4 bg-white rounded-xl border border-slate-200 overflow-hidden flex flex-col shadow-sm">
                    <div class="p-3 bg-slate-50 border-b"><div class="text-xs font-bold text-slate-500 uppercase mb-2 ml-1">é¸æ“‡å­¸ç”Ÿ</div></div>
                    <div class="overflow-y-auto flex-1 p-2 space-y-2">
                        <div id="student-btn-S001" onclick="loadStudentData('S001')" class="student-item p-3 rounded-lg cursor-pointer border border-transparent hover:bg-slate-50 transition active-student">
                            <div class="flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">å¼µ</div><div><div class="font-bold text-slate-700 text-sm">å¼µå°æ˜</div><div class="text-[10px] text-slate-500">è§€é»æ©‹æ¨‘è€…</div></div></div><span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">æˆé•·å‹</span></div>
                        </div>
                        <div id="student-btn-S002" onclick="loadStudentData('S002')" class="student-item p-3 rounded-lg cursor-pointer border border-transparent hover:bg-slate-50 transition">
                            <div class="flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-red-100 text-red-600 flex items-center justify-center font-bold">æ</div><div><div class="font-bold text-slate-700 text-sm">æç¾è‰</div><div class="text-[10px] text-slate-500">è§€å¯Ÿè€…</div></div></div><span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full">åœæ»¯å‹</span></div>
                        </div>
                    </div>
                </div>
                <div class="w-full lg:w-3/4 space-y-6 overflow-y-auto pr-2 pb-10" id="student-detail-panel">
                    <div class="card bg-gradient-to-r from-white to-slate-50 border-l-4 border-blue-500" id="profile-card">
                        <div class="flex justify-between items-start">
                            <div class="flex gap-5"><div id="profile-avatar" class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center text-2xl font-bold text-blue-600 border-4 border-white shadow-sm">å¼µ</div><div><h3 class="text-xl font-bold text-slate-800 flex items-center"><span id="profile-name">å¼µå°æ˜</span> <span class="text-sm text-slate-400 font-normal ml-2" id="profile-id">S001</span></h3><div class="flex gap-2 mt-2" id="profile-badges"></div><div class="mt-3 text-sm text-slate-600"><i class="fas fa-info-circle text-blue-400 mr-1"></i> <span id="profile-status-text">è¼‰å…¥ä¸­...</span></div></div></div>
                            <div class="text-right"><div class="text-3xl font-bold text-slate-800" id="profile-notes-count">0</div><div class="text-xs text-slate-500 uppercase">Total Notes</div></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card"><div class="flex justify-between items-center mb-4"><h4 class="font-bold text-sm text-slate-700 uppercase">èªçŸ¥æ·±åº¦æ¼”åŒ– (Depth)</h4><button class="ref-btn" onclick="openRef('depth_trajectory')"><i class="fas fa-book"></i> Ref:</button></div><div class="h-48 relative"><canvas id="studentDepthChart"></canvas></div></div>
                        <div class="card"><div class="flex justify-between items-center mb-4"><h4 class="font-bold text-sm text-slate-700 uppercase">çŸ¥è­˜èƒ½åŠ› DNA</h4><button class="ref-btn" onclick="openRef('radar')"><i class="fas fa-book"></i> Ref:</button></div><div class="h-48 relative"><canvas id="radarChart"></canvas></div></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card"><div class="flex justify-between items-center mb-2"><h4 class="font-bold text-sm text-slate-700 uppercase mr-2">è‡ªæˆ‘äº’å‹•åœˆ (Ego Network)</h4><button class="ref-btn" onclick="openRef('ego')"><i class="fas fa-book"></i> Ref:</button></div><div class="h-48 bg-slate-50 rounded border border-slate-100 relative"><div id="ego-network-container" class="absolute inset-0"></div></div><div class="text-xs text-right mt-2 text-slate-500" id="ego-metric">--</div></div>
                        <div class="card border-l-4" id="ai-card"><h4 class="font-bold text-sm text-slate-700 uppercase mb-3 flex items-center"><i class="fas fa-robot mr-2 text-blue-500"></i> AI ç¶œåˆè¡Œå‹•å»ºè­°</h4><div class="space-y-3" id="ai-suggestions"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: ä¸»é¡Œèˆ‡è§€é» (Ideas) -->
        <div id="view-topics" class="section-view active space-y-6">
            <header><h2 class="text-2xl font-bold text-slate-800">è§€é»æ½›åŠ›èˆ‡æ¼”åŒ– (Ideas)</h2><p class="text-sm text-slate-500">æ¦‚å¿µç¶²çµ¡èˆ‡è©å½™æˆé•·åˆ†æ (Epistemic Network & Lexical Growth)</p></header>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card h-[400px]">
                    <div class="flex justify-between items-center mb-4"><div><h3 class="font-bold text-slate-800">1. æ½›åŠ›è§€é»ç†±é»åœ–</h3><p class="text-xs text-slate-500">Interest vs. Gap</p></div><button class="ref-btn" onclick="openRef('promisingness')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div class="relative flex-1 bg-slate-50 border border-slate-200 rounded-lg p-4">
                        <div class="absolute bottom-2 right-4 text-xs font-bold text-slate-400">é—œæ³¨åº¦ â†’</div><div class="absolute top-4 left-2 text-xs font-bold text-slate-400 rotate-90 origin-left">â† èªçŸ¥è½å·®</div>
                        <div class="absolute top-1/2 left-0 right-0 h-px bg-slate-300 border-t border-dashed"></div><div class="absolute left-1/2 top-0 bottom-0 w-px bg-slate-300 border-l border-dashed"></div>
                        <div class="absolute top-[20%] right-[20%] cursor-pointer group"><div class="w-4 h-4 bg-red-500 rounded-full shadow-lg hotspot-dot"></div><div class="absolute -top-8 -left-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-10">T1: å…‰åˆä½œç”¨</div></div>
                    </div>
                </div>
                <div class="card h-[400px]">
                    <div class="flex justify-between items-center mb-4"><div><h3 class="font-bold text-slate-800">2. æ¦‚å¿µèªç¾©ç¶²çµ¡ (Concept Space)</h3><p class="text-xs text-slate-500">é—œéµå­—é€£çµçµæ§‹</p></div><button class="ref-btn" onclick="openRef('concept_network')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div id="concept-network-container" class="h-full bg-slate-50 rounded border border-slate-100"></div>
                </div>
                <div class="card h-[400px]">
                    <div class="flex justify-between items-center mb-4"><div><h3 class="font-bold text-slate-800">3. å­¸è¡“è©å½™æˆé•· (Lexical Growth)</h3><p class="text-xs text-slate-500">å°ˆæ¥­è¡“èªç´¯ç©è¶¨å‹¢</p></div><button class="ref-btn" onclick="openRef('lexical_growth')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div class="relative h-full"><canvas id="lexicalChart"></canvas></div>
                </div>
                <div class="card h-[400px] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6"><div><h3 class="font-bold text-slate-800">4. è§€é»æ¼”åŒ–è·¯å¾‘ (Evolution)</h3><p class="text-xs text-slate-500">å¾ç™¼æ•£åˆ°æ•´åˆ</p></div><button class="ref-btn" onclick="openRef('rise_above')"><i class="fas fa-book"></i> Ref:</button></div>
                    <div class="relative pl-8 space-y-10"><div class="timeline-line"></div>
                        <div class="relative z-10"><div class="absolute -left-10 top-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center border-2 border-white text-blue-600 text-xs font-bold">W1</div><div class="bg-slate-50 border border-slate-200 p-4 rounded-lg"><div class="text-xs text-slate-400 uppercase font-bold mb-2">ç™¼æ•£éšæ®µ</div><div class="bg-white p-3 border rounded shadow-sm text-sm">My Theory: æ¤ç‰©åƒåœŸ...</div></div></div>
                        <div class="relative z-10"><div class="absolute -left-10 top-0 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center border-2 border-white text-white text-xs font-bold">W5</div><div class="bg-green-50 border border-green-200 p-5 rounded-lg shadow-sm"><div class="text-xs text-green-700 uppercase font-bold mb-2">æ•´åˆéšæ®µ (Rise-above)</div><h4 class="font-bold text-slate-800">èƒ½é‡è½‰åŒ–å·¥å» ç†è«–</h4></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW 4: è¨€è«‡å“è³ª (Quality) -->
        <div id="view-quality" class="section-view space-y-6">
            <header><h2 class="text-2xl font-bold text-slate-800">èªçŸ¥è¨€è«‡å“è³ªåˆ†æ (Quality)</h2><p class="text-sm text-slate-500">è¦–è¦ºåŒ–ç­ç´šå°è©±çš„ã€Œæ·±åº¦çµæ§‹ã€èˆ‡ã€Œå‹•æ…‹æµå‘ã€</p></header>
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <div><h3 class="font-bold text-slate-800 flex items-center"><i class="fas fa-search-plus text-purple-600 mr-2"></i> æ·±åº¦å°è©±é€è¦–é¡ (Deep Discourse Lens)</h3><p class="text-xs text-slate-500 mt-1">äº’å‹•èªªæ˜ï¼šé»æ“Šç¯€é»æˆ–é€£ç·šå¯æŸ¥çœ‹<strong>å­¸ç”Ÿå¯¦ä¾‹ (Student Voices)</strong> èˆ‡æ•™å­¸æ„ç¾©ã€‚</p></div>
                    <div class="flex gap-4 text-xs font-bold bg-slate-50 px-3 py-2 rounded-lg border border-slate-200">
                        <div class="flex items-center"><span class="legend-dot dot-fact"></span> äº‹å¯¦</div><div class="flex items-center"><span class="legend-dot dot-theory"></span> ç†è«–</div><div class="flex items-center"><span class="legend-dot dot-challenge"></span> æŒ‘æˆ°</div><div class="flex items-center"><span class="legend-dot dot-synthesis"></span> æ•´åˆ</div>
                    </div>
                </div>
                <div class="flex flex-col lg:flex-row gap-6">
                    <div class="w-full lg:w-2/3 h-[350px] bg-slate-50 rounded border border-slate-100 relative"><div id="lens-network-container" class="absolute inset-0"></div></div>
                    <div class="w-full lg:w-1/3 flex flex-col justify-center">
                        <div class="lens-detail-box" id="lens-detail"><div class="lens-detail-title text-slate-500"><i class="fas fa-mouse-pointer mr-2"></i> è«‹é»æ“Šå·¦å´åœ–è¡¨</div><p class="text-slate-400">é»æ“Šã€Œç¯€é»ã€æŸ¥çœ‹èªçŸ¥ç‹€æ…‹å®šç¾©èˆ‡å­¸ç”Ÿç™¼è¨€ç¯„ä¾‹ã€‚<br>é»æ“Šã€Œé€£ç·šã€æŸ¥çœ‹å°è©±é·ç§»æ„ç¾©ã€‚</p></div>
                        <div class="mt-4 text-right"><button class="ref-btn" onclick="openRef('lens')"><i class="fas fa-book"></i> Ref:</button></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <div><h3 class="font-bold text-slate-800 flex items-center"><i class="fas fa-stream text-blue-500 mr-2"></i> é—œéµå°è©±æµ (Key Discourse Stream)</h3><p class="text-xs text-slate-500 mt-1">è¿½è¹¤èªçŸ¥æ¼”åŒ–è¶¨å‹¢èˆ‡é—œéµè½‰æŠ˜é»</p></div>
                    <button class="ref-btn" onclick="openRef('stream')"><i class="fas fa-book"></i> Ref:</button>
                </div>
                <div class="h-[300px] w-full relative"><canvas id="streamChart"></canvas></div>
            </div>
        </div>

    </main>

    <script>
        // --- 1. ENHANCED REF DATA (BASED ON UPLOADED IMAGES) ---
        const refData = {
            'gini': { 
                title: 'çŸ¥è­˜æ°‘ä¸»åŒ– (Knowledge Democratization)', 
                desc: 'æœ¬æŒ‡æ¨™åŸºæ–¼ Gini Coefficient æŒ‡æ•¸è¨ˆç®—åƒèˆ‡è²¢ç»çš„åˆ†å¸ƒã€‚åœ¨çŸ¥è­˜å»ºæ§‹ç¤¾ç¾¤ä¸­ï¼Œã€ŒçŸ¥è­˜æ°‘ä¸»åŒ–ã€æ„å‘³è‘—æ¯å€‹äººçš„è§€é»éƒ½å°ç¤¾ç¾¤æœ‰åƒ¹å€¼ã€‚ä½ Gini å€¼åæ˜ å‡ºç¤¾ç¾¤å…§è§€é»è²¢ç»é«˜åº¦å‡å‹»ï¼Œä¸å­˜åœ¨æ¬Šå¨å£Ÿæ–·ï¼Œæœ‰åˆ©æ–¼é›†é«”æ™ºæ…§çš„è¿¸ç™¼ã€‚', 
                analysis: 'ç•¶å‰ Gini ä¿‚æ•¸ç‚º 0.21ï¼Œé ä½æ–¼é è­¦é–¾å€¼ (0.4)ã€‚é€™é¡¯ç¤ºæœ¬ç­ç´šå·²å½¢æˆã€Œé›†é«”è²¬ä»»æ„Ÿ (Collective Responsibility)ã€ï¼Œä¸å†æ˜¯ç”±å°‘æ•¸å„ªç”Ÿå¸¶é ˜ï¼Œè€Œæ˜¯å…¨å“¡åƒèˆ‡ã€‚æ•™å­¸å»ºè­°ï¼šå¯é–‹å§‹å¼•å°å­¸ç”Ÿé€²è¡Œæ›´å…·æŒ‘æˆ°æ€§çš„ã€Œè·¨çµ„å°è©±ã€ã€‚', 
                cite: 'Scardamalia, M. (2002). Collective Cognitive Responsibility for the Advancement of Knowledge. Education and Technology.' 
            },
            'density': { 
                title: 'ç¤¾ç¾¤äº’å‹•å¯†åº¦ (Social Network Density)', 
                desc: 'Density è¡¡é‡ç¤¾ç¾¤ä¸­å¯¦éš›é€£çµæ•¸èˆ‡æœ€å¤§å¯èƒ½é€£çµæ•¸çš„æ¯”å€¼ã€‚é«˜å¯†åº¦ä»£è¡¨æˆå“¡é–“äº’å‹•é »ç¹ï¼Œè³‡è¨Šæµå‹•æµæš¢ã€‚é€™å°æ‡‰ KB åŸå‰‡ä¸­çš„ã€Œç¤¾ç¾¤çŸ¥è­˜èˆ‡é›†é«”è²¬ä»»ã€ï¼Œå¼·èª¿çŸ¥è­˜æ˜¯åœ¨äº’å‹•ä¸­è¢«å…±åŒå®šç¾©èˆ‡æ“´å¼µçš„ã€‚', 
                analysis: 'æœ¬é€± Density ç‚º 0.45ï¼Œå‘ˆç¾ç©©å¥ä¸Šå‡è¶¨å‹¢ï¼Œä½†è·é›¢å­¸è¡“ç†æƒ³å€¼ (0.6) ä»æœ‰ç©ºé–“ã€‚ç›®å‰çš„äº’å‹•å¤šé›†ä¸­åœ¨å­ç¾¤çµ„å…§éƒ¨ã€‚æ•™å­¸å»ºè­°ï¼šåˆ©ç”¨ã€Œä¸²è¯è§€é» (Rise-above)ã€ä»»å‹™ï¼Œå¼·è¿«è·¨çµ„åˆ¥çš„äº’è©•èˆ‡å›é¥‹ï¼Œä»¥æå‡å…¨ç­é€£çµå¯†åº¦ã€‚', 
                cite: 'Zhang, J., Scardamalia, M., Reeve, R., & Messina, R. (2009). Designs for collectively advancing communal knowledge.' 
            },
            'depth': { 
                title: 'è¨è«–æ·±åº¦ (Discourse Depth & Idea Diversity)', 
                desc: 'è¨è«–æ·±åº¦é€éç­†è¨˜çš„å›è¦†éˆå±¤ç´šè¨ˆç®—ã€‚é€™åæ˜ äº†ç¤¾ç¾¤æ˜¯å¦å°å–®ä¸€å•é¡Œé€²è¡Œã€ŒæŒçºŒæ€§çš„æ”¹é€² (Sustained Improvement)ã€ã€‚é«˜å±¤æ¬¡çš„å°è©±éˆä»£è¡¨å­¸ç”Ÿèƒ½é‡å°ä»–äººè§€é»é€²è¡Œæ·±åŒ–ã€åè­‰æˆ–åˆæˆï¼Œè€Œéåƒ…åœç•™åœ¨ç°¡å–®çš„è´ŠåŒæˆ–ç™¼æ•£ã€‚', 
                analysis: 'å¹³å‡æ·±åº¦ 4.2 å±¤ä»£è¡¨å°è©±å·²è·¨è¶Šè¡¨å±¤è³‡è¨Šäº¤æ›ã€‚ç¬¬ 4 å±¤ç´šé€šå¸¸åŒ…å«ã€Œç†è«–å‡è¨­ã€èˆ‡ã€Œè­‰æ“šå°è©±ã€ã€‚æ•™å­¸å»ºè­°ï¼šé‡å°ç¬¬ 2 å±¤ä»¥ä¸‹çš„ã€Œå­¤ç«‹è§€é»ã€ï¼Œæ•™å¸«æ‡‰ä»‹å…¥æå‡ºå¼•å°å•é¡Œï¼Œå¸¶å‹•è©²æ”¯ç·šçš„æ·±åº¦ç™¼å±•ã€‚', 
                cite: 'Scardamalia, M., & Bereiter, C. (2006). Knowledge building: Theory, pedagogy, and technology.' 
            },
            'risk': { 
                title: 'é‚Šç·£åƒèˆ‡è€…è¨ºæ–· (Marginalized Participators)', 
                desc: 'é€é SNA çš„ä¸­å¿ƒæ€§ (Centrality) æŒ‡æ¨™è­˜åˆ¥å‡ºä½æ–¼é‚Šç·£ã€å…¥åº¦èˆ‡å‡ºåº¦å‡é¡¯è‘—ä½æ–¼å¹³å‡å€¼çš„å­¸ç”Ÿã€‚é•·æœŸè™•æ–¼é‚Šç·£å¯èƒ½å°è‡´èªçŸ¥å­¤ç«‹ï¼Œå½±éŸ¿ç¤¾ç¾¤æ•´é«”çš„ã€Œæ°‘ä¸»åŒ–ã€ç¨‹åº¦ã€‚', 
                analysis: 'åµæ¸¬åˆ° 3 ä½å­¸ç”Ÿåƒèˆ‡åº¦é¡¯è‘—ä¸‹æ»‘ã€‚é€™ä¸¦éå–®ç´”çš„æ‡¶æƒ°ï¼Œå¾€å¾€æ˜¯å› ã€Œç„¡æ³•èå…¥ç•¶å‰é«˜éšå­¸è¡“å°è©±ã€ã€‚æ•™å­¸å»ºè­°ï¼šæ•™å¸«æ‡‰å”åŠ©é€™é¡å­¸ç”Ÿå°‡ç”Ÿæ´»ç¶“é©—è½‰åŒ–ç‚ºã€ŒçœŸå¯¦å•é¡Œ (Real Ideas)ã€ï¼Œé‡æ–°æ¥å›ç¤¾ç¾¤ä¸»å¹¹ã€‚', 
                cite: 'Lave, J., & Wenger, E. (1991). Situated Learning: Legitimate Peripheral Participation.' 
            },
            'sna': { 
                title: 'ç¤¾ç¾¤ç¶²çµ¡çµæ§‹åˆ†æ (SNA Metrics)', 
                desc: 'åˆ†æç¤¾ç¾¤çš„æ•´é«”æ‹“æ’²ã€‚åŒ…å«ä¸­å¿ƒè€… (Central Figures)ã€æ©‹æ¨‘è€… (Brokers) èˆ‡å­¤ç«‹é»ã€‚å¥åº·çš„ KB ç¤¾ç¾¤æ‡‰å‘ˆç¾ã€Œåˆ†æ•£å¼ç¶²çµ¡ã€ï¼Œè€Œéæ˜Ÿç‹€ç¶²çµ¡ã€‚', 
                analysis: 'æœ¬ç­å‘ˆç¾å¤šä¸­å¿ƒçµæ§‹ï¼Œé€™éå¸¸ç†æƒ³ã€‚ç‰¹åˆ¥æ˜¯å¼µå°æ˜æ‰®æ¼”äº†å¼·å¤§çš„æ©‹æ¨‘è§’è‰²ã€‚ä½†è¦æ³¨æ„ã€Œé‚Šç·£å­ç¾¤çµ„ã€çš„å›ºåŒ–ã€‚å»ºè­°é€éã€Œè§€é»äº¤æ›æ—¥ã€æ‰“ç ´æ—¢æœ‰çš„æœ‹å‹åœˆçµæ§‹ã€‚', 
                cite: 'Oshima, J., Oshima, R., & Matsuzawa, Y. (2012). Knowledge Building Discourse Analysis.' 
            },
            'principles': { 
                title: 'KB 12 åŸå‰‡è½å¯¦è¨ºæ–· (12 Principles Alignment)', 
                desc: 'é€™æ˜¯ä¸€å€‹å¤šç¶­åº¦çš„é‡åŒ–è©•ä¼°ï¼Œå°‡èªæ„åˆ†æèˆ‡ SNA æ•¸æ“šæ˜ å°„åˆ° KB çš„æ ¸å¿ƒåŸå‰‡ä¸Šã€‚å®ƒèƒ½ç›´è§€é¡¯ç¤ºç¤¾ç¾¤åœ¨ã€Œç†è«–åŒ–ã€èˆ‡ã€ŒçœŸå¯¦å•é¡Œã€ç­‰ä¸åŒé¢å‘çš„é”æˆåº¦ã€‚', 
                analysis: 'æœ¬ç­åœ¨ã€Œè§€é»å¤šæ¨£æ€§ã€èˆ‡ã€Œæ°‘ä¸»åŒ–ã€è¡¨ç¾å„ªç•°ï¼Œä½†ã€Œæ¬Šå¨è³‡æ–™çš„ä½¿ç”¨ (Constructive use of authority)ã€åä½ã€‚é€™ä»£è¡¨å­¸ç”Ÿå¤šåœ¨è‡†æ¸¬ï¼Œç¼ºä¹å¤–éƒ¨ç§‘å­¸è­‰æ“šæ”¯æ’ã€‚æ•™å­¸å»ºè­°ï¼šä¸‹é€±æ‡‰å¼•å…¥å¤–éƒ¨æ–‡ç»è³‡æºä¾›å­¸ç”Ÿå¼•ç”¨ã€‚', 
                cite: 'Gan, Y., et al. (2021). Quantifying Knowledge Building Principles: A Multi-modal approach.' 
            },
            'promisingness': { 
                title: 'æ½›åŠ›è§€é»åˆ†æ (Promising Ideas)', 
                desc: 'åˆ†æã€Œé«˜é—œæ³¨åº¦ã€ä½†ã€Œè§£é‡‹åŠ›å°šæœ‰è½å·®ã€çš„ä¸»é¡Œã€‚é€™æ˜¯ç¤¾ç¾¤æœ€å€¼å¾—æŠ•å…¥ç²¾åŠ›å»è¡åˆºçš„æ–¹å‘ã€‚å®ƒèƒ½å¼•å°å­¸ç”Ÿè­˜åˆ¥å‡ºå“ªäº›è§€é»æœ€å…·æœ‰ã€Œæ˜‡è¯ (Rise-above)ã€çš„å¯èƒ½æ€§ã€‚', 
                analysis: 'ã€Œå…‰åˆä½œç”¨çš„èƒ½é‡ä¾†æºã€ç›®å‰ä½æ–¼ç†±å€æ ¸å¿ƒã€‚å­¸ç”Ÿå°æ­¤å……æ»¿å¥½å¥‡ä½†ç¾æœ‰ç­†è¨˜çš„ç†è«–æ•´åˆåº¦ä½ã€‚é€™æ˜¯ä¸€å€‹æ¥µä½³çš„ã€Œæ•™å­¸è½‰æŠ˜é»ã€ï¼Œå¯å¼•å°å­¸ç”Ÿé€²è¡Œæ­£å¼å¯¦é©—è¨­è¨ˆã€‚', 
                cite: 'Chen, B., Scardamalia, M., & Bereiter, C. (2015). Predictive analytics for promising ideas in Knowledge Building.' 
            },
            'lexical_growth': { 
                title: 'å­¸è¡“è©å½™æˆé•· (Lexical Growth & Epistemic Agency)', 
                desc: 'è¿½è¹¤å­¸ç”Ÿå¾æ—¥å¸¸å£èªå‘å°ˆæ¥­å­¸è¡“è¡“èªé·ç§»çš„éç¨‹ã€‚å­¸è¡“è©å½™çš„å¢åŠ ä»£è¡¨å­¸ç”Ÿæ­£åœ¨å…§åŒ–å­¸ç§‘é ˜åŸŸçš„èªåŒï¼Œä¸¦èƒ½ç²¾ç¢ºåœ°é‹ç”¨æ¬Šå¨æ¦‚å¿µä¾†é€²è¡Œæ€è€ƒã€‚', 
                analysis: 'W4 åˆ° W5 è©å½™é‡å‘ˆç¾æŒ‡æ•¸å¢é•·ï¼Œç‰¹åˆ¥æ˜¯ã€Œå…‰åæ‡‰ã€ã€ã€Œé¡å›Šé«”ã€ç­‰è©é »æš´å¢ã€‚é€™é¡¯ç¤ºå­¸ç”Ÿå·²å¾ã€Œè§€å¯Ÿç¾è±¡ã€é€²å…¥ã€Œæ©Ÿåˆ¶è§£é‡‹ã€éšæ®µã€‚', 
                cite: 'Resendes, M., et al. (2015). The effect of formative feedback on vocabulary use in Knowledge Building.' 
            },
            'rise_above': { 
                title: 'è§€é»æ˜‡è¯ (Rise-above) æ­·ç¨‹', 
                desc: 'Rise-above æ˜¯ KB çš„éˆé­‚ã€‚å®ƒè¦æ±‚å­¸ç”Ÿå°‡å¤§é‡ã€ç™¼æ•£ã€ç”šè‡³çŸ›ç›¾çš„åˆéšè§€é»ï¼Œæ•´åˆæˆç‚ºä¸€å€‹æ›´é«˜éšã€æ›´ç°¡æ½”ä¸”å…·å‚™æ›´å¼·è§£é‡‹åŠ›çš„ç†è«–æ¶æ§‹ã€‚', 
                analysis: 'æœ¬é€± T1 ä¸»é¡ŒæˆåŠŸç”¢å‡ºäº†æ•´åˆæ€§ç­†è¨˜ã€‚å¾åˆæœŸçš„ã€Œæ¤ç‰©åƒåœŸã€åˆ°ä¸­æœŸçš„ã€Œé™½å…‰é©…å‹•ã€ï¼Œæœ€å¾Œæ”¶æ–‚è‡³ã€Œç”Ÿç‰©èƒ½é‡å·¥å» ã€ã€‚é€™æ˜¯å®Œç¾çš„èªçŸ¥è½‰æ›ã€‚', 
                cite: 'Zhang, J., et al. (2018). Evolutionary patterns of ideas in Knowledge Building communities.' 
            },
            'lens': { 
                title: 'æ·±åº¦å°è©±é€è¦–é¡ (Deep Discourse Sequential Analysis)', 
                desc: 'åˆ©ç”¨åºåˆ—åˆ†æ (Sequential Analysis) æŸ¥çœ‹å°è©±çš„æ¼”åŒ–è·¯å¾‘ã€‚é‡é»åœ¨æ–¼æ•æ‰ã€Œæ‰¹åˆ¤æ€§è½‰æŠ˜ã€ã€‚ä¾‹å¦‚ï¼šç•¶ä¸€å€‹ã€Œç†è«–ã€è¢«æå‡ºå¾Œï¼Œå¾ŒçºŒæ˜¯è·Ÿéš¨å¦ä¸€å€‹ã€Œç†è«–ã€(ç™¼æ•£)ï¼Œé‚„æ˜¯è·Ÿéš¨ä¸€å€‹ã€ŒæŒ‘æˆ°ã€(æ·±åº¦è¾¯è­‰)ï¼Ÿ', 
                analysis: 'é€è¦–åœ–é¡¯ç¤ºæœ¬ç­æœ‰å¼·å¤§çš„ã€Œç†è«–->æŒ‘æˆ°ã€æ­£å‘å¾ªç’°ï¼Œé »ç‡é«˜æ–¼å¹³å‡å€¼ã€‚é€™æ„å‘³è‘—å­¸ç”Ÿå·²å…·å‚™æ‰¹åˆ¤æ€§æ€ç¶­ã€‚è‹¥è·¯å¾‘å¤šç‚ºã€Œäº‹å¯¦->äº‹å¯¦ã€ï¼Œå‰‡éœ€ä»‹å…¥å¼•å°å­¸ç”Ÿé€²è¡Œè§£é‡‹æ€§æ€è€ƒã€‚', 
                cite: 'Chen, B., et al. (2017). Sequential patterns in Knowledge Building discourse.' 
            },
            'stream': { 
                title: 'é—œéµå°è©±æµ (Dynamic Discourse Stream)', 
                desc: 'æ²³æµåœ–å±•ç¤ºéš¨æ™‚é–“æ¨ç§»ï¼Œå„é¡èªçŸ¥è¡Œç‚ºçš„å‹•æ…‹å æ¯”ã€‚é€™æœ‰åŠ©æ–¼è§€å¯Ÿç¤¾ç¾¤æ˜¯å¦æ­£åœ¨å¾ã€Œè³‡æ–™è’é›† (Fact)ã€é‚å‘ã€Œé«˜éšæ•´åˆ (Synthesis)ã€ã€‚', 
                analysis: 'åœ–è¡¨é¡¯ç¤ºã€Œæ•´åˆå±¤ç´šã€åœ¨ W5 å¿«é€Ÿæ“´å±•ï¼Œæ“ å£“äº†ç´”äº‹å¯¦æè¿°çš„ç©ºé–“ã€‚é€™ä»£è¡¨å…¨ç­æ­£åœ¨ç¶“æ­·é›†é«”èªçŸ¥çš„ã€Œæ”¶å‰²æœŸã€ã€‚', 
                cite: 'Reimann, P. (2009). Time is of the essence: Learning as a process.' 
            },
            'depth_trajectory': { 
                title: 'èªçŸ¥æ·±åº¦æ¼”åŒ–è»Œè·¡', 
                desc: 'è¿½è¹¤å­¸ç”Ÿå€‹äººåœ¨ã€Œäº‹å¯¦æè¿°ã€èˆ‡ã€Œç†è«–å»ºæ§‹ã€å…©æ¢æ›²ç·šä¸Šçš„å‹•æ…‹å¹³è¡¡ã€‚ç†æƒ³ç‹€æ…‹æ˜¯éš¨è‘—æ™‚é–“æ¨ç§»ï¼Œç†è«–æ¯”é‡é€æ¼¸è¶…è¶Šäº‹å¯¦æ¯”é‡ã€‚', 
                analysis: 'S001 åœ¨æœ¬é€±å‡ºç¾ã€ŒèªçŸ¥äº¤å‰é»ã€ï¼Œç†è«–æ€§ç™¼è¨€é‡é¦–åº¦è¶…éäº‹å¯¦æ€§ç™¼è¨€ï¼Œæ¨™èªŒè‘—ä»–å¾ã€Œè³‡è¨Šæ”¶é›†è€…ã€è½‰å‹ç‚ºã€Œç†è«–å»ºæ§‹è€…ã€ã€‚', 
                cite: 'Scardamalia, M. (2002).' 
            },
            'radar': { 
                title: 'çŸ¥è­˜èƒ½åŠ› DNA', 
                desc: 'åŸºæ–¼è‡ªç„¶èªè¨€è™•ç† (NLP) èˆ‡ SNA ç¶œåˆè¨ˆç®—ã€‚åŒ…å«ï¼šç™¼èµ·èƒ½åŠ› (Initiative)ã€ç†è«–å»ºæ§‹ (Theorizing)ã€å›é¥‹å“è³ª (Social Responsibility)ã€åˆæˆèƒ½åŠ› (Synthesis) èˆ‡è©å½™å¤šæ¨£æ€§ã€‚', 
                analysis: 'æ­¤åœ–è­œèƒ½ç²¾æº–è­˜åˆ¥å­¸ç”Ÿå¤©è³¦ã€‚ä¾‹å¦‚ï¼šS001 æ“…é•·é€£çµä»–äºº (Social)ï¼Œä½†æ•´åˆèƒ½åŠ›ä»æœ‰æå‡ç©ºé–“ã€‚å¯ç”¨æ–¼å·®ç•°åŒ–åˆ†çµ„èˆ‡ç²¾æº–è¼”å°ã€‚', 
                cite: 'Lee, J. Q., et al. (2006).' 
            },
            'ego': { 
                title: 'è‡ªæˆ‘äº’å‹•åœˆ (Ego Network)', 
                desc: 'åˆ†æå­¸ç”Ÿå€‹äººç‚ºä¸­å¿ƒçš„å¾®è§€ç¤¾äº¤çµæ§‹ã€‚æ©‹æ¨‘å‹ (Broker) å­¸ç”Ÿèƒ½ä¿ƒé€²è³‡è¨Šè·¨çµ„æµå‹•ï¼›æ ¸å¿ƒå‹å­¸ç”Ÿå‰‡ç©©å®šç¤¾ç¾¤å…±è­˜ã€‚', 
                analysis: 'æœ¬åœ–é¡¯ç¤ºè©²ç”Ÿç›®å‰çš„äº’å‹•ç¯„åœã€‚è‹¥é€£ç·šéæ–¼å–®ä¸€ï¼ˆåƒ…èˆ‡è€å¸«é€£çµï¼‰ï¼Œå‰‡éœ€é¼“å‹µå…¶åƒèˆ‡åŒå„•è¨è«–ã€‚', 
                cite: 'Oshima, J., et al. (2012).' 
            }
        };

        // --- 2. LENS INTERACTIONS ---
        const lensInteractions = {
            'Fact': { title: 'äº‹å¯¦ (Fact)', text: 'å–®ç´”çš„è³‡æ–™ç¾…åˆ—ã€æè¿°ç¾è±¡ã€è½‰è²¼ç¶²å€ã€‚', color: 'border-l-slate-400 bg-slate-50', example: 'ã€Œæ›¸ä¸Šç¬¬50é èªªï¼Œå…‰åˆä½œç”¨éœ€è¦æ°´å’ŒäºŒæ°§åŒ–ç¢³æ‰èƒ½é€²è¡Œã€‚ã€' },
            'Theory': { title: 'ç†è«– (Theory)', text: 'åŸºæ–¼è§€å¯Ÿæå‡ºçš„å€‹äººè§£é‡‹ã€å‡èªªæˆ–ã€ŒMy Theoryã€ã€‚', color: 'border-l-blue-500 bg-blue-50', example: 'ã€Œæˆ‘èªç‚ºè‘‰å­æœƒè®Šç´…æ˜¯å› ç‚ºå¤©æ°£å†·äº†ï¼Œè‘‰ç¶ ç´ å®³æ€•å¯’å†·æ‰€ä»¥èº²èµ·ä¾†äº†ã€‚ã€' },
            'Challenge': { title: 'æŒ‘æˆ° (Challenge)', text: 'å°ä»–äººè§€é»æå‡ºåè­‰ã€è³ªç–‘ã€å°‹æ‰¾ä¸ä¸€è‡´è™•ã€‚', color: 'border-l-yellow-500 bg-yellow-50', example: 'ã€Œå¦‚æœè‘‰ç¶ ç´ æ˜¯å› ç‚ºæ€•å†·æ‰èº²èµ·ä¾†ï¼Œé‚£ç‚ºä»€éº¼æœ‰äº›æ¨¹å³ä½¿åœ¨ä¸‹é›ªä¹Ÿä¸æœƒè®Šç´…ï¼Ÿã€' },
            'Synthesis': { title: 'æ•´åˆ (Synthesis)', text: 'æ­¸ç´å¤šäººçœ‹æ³•ï¼Œæ¶ˆé™¤çŸ›ç›¾ï¼Œç”¢å‡ºæ›´é«˜å±¤æ¬¡çš„å…±è­˜ã€‚', color: 'border-l-green-500 bg-green-50', example: 'ã€Œç¶œåˆå¤§å®¶çš„è³‡æ–™å’Œå°å¤©æ°£çš„è¨è«–ï¼Œé€™å…¶å¯¦æ˜¯æ¤ç‰©åœ¨å›æ”¶é¤Šåˆ†ï¼Œæº–å‚™éå†¬çš„æ©Ÿåˆ¶ã€‚ã€' },
            'Fact->Theory': { title: 'è·¯å¾‘ï¼šäº‹å¯¦ â” ç†è«–', text: 'èªçŸ¥è·¨è¶Šé»ã€‚ä»£è¡¨å­¸ç”Ÿä¸å†åªæ˜¯æ¬é‹å·¥ï¼Œè€Œé–‹å§‹å˜—è©¦è³¦äºˆè³‡æ–™æ„ç¾©ã€‚', color: 'border-l-blue-400 bg-blue-50', example: 'ã€Œçœ‹åˆ°é€™è³‡æ–™å¯«è‘—æ¤ç‰©æœ‰æ°£å­”...æˆ‘æ¨æ¸¬æ¤ç‰©æ˜¯ä¸æ˜¯ä¹Ÿè¦å‘¼å¸ï¼Ÿã€' },
            'Theory->Challenge': { title: 'è·¯å¾‘ï¼šç†è«– â” æŒ‘æˆ°', text: 'æ·±åº¦è¾¯è­‰çš„ç™¼ç”Ÿã€‚ç¤¾ç¾¤é–‹å§‹é€²å…¥ã€Œè§€é»æ”¹é€²ã€çš„é«˜å£“åŠ›å€ï¼Œé€™æ˜¯æˆé•·æœ€å¿«çš„æ™‚å€™ã€‚', color: 'border-l-yellow-400 bg-yellow-50', example: 'ã€Œä½ çš„ç†è«–èªªè‘‰ç¶ ç´ æ˜¯èº²èµ·ä¾†ï¼Œä½†é¡¯å¾®é¡ä¸‹çœ‹åˆ°çš„æ˜¯åˆ†è§£è€¶...ã€' },
            'Challenge->Synthesis': { title: 'è·¯å¾‘ï¼šæŒ‘æˆ° â” æ•´åˆ', text: 'è¡çªçš„è§£æ±ºã€‚ä»£è¡¨ç¤¾ç¾¤æˆåŠŸå°‡çŸ›ç›¾è½‰åŒ–ç‚ºæ›´é«˜éšçš„çŸ¥è­˜ï¼Œé”æˆ Rise-aboveã€‚', color: 'border-l-green-400 bg-green-50', example: 'ã€Œç‚ºäº†è§£æ±ºåˆ†è§£é‚„æ˜¯èº²èµ·ä¾†çš„çŸ›ç›¾ï¼Œæˆ‘å€‘ç™¼ç¾å…¶å¯¦é‚£æ˜¯è‰²ç´ æ¯”ä¾‹æ”¹è®Šçš„çµæœ...ã€' }
        };

        // --- GLOBAL VARS ---
        let overviewNetwork, radarChartInstance, studentDepthChartInstance, egoNetworkInstance, streamChart, lensNetwork, principlesChartInstance, conceptNetworkInstance, lexicalChartInstance;

        // --- HELPERS ---
        function openRef(key) {
            const data = refData[key] || {title:'è¼‰å…¥ä¸­', desc:'...', analysis:'...', cite:'...'};
            document.getElementById('modal-title').innerHTML = `<i class="fas fa-book-reader text-blue-500 mr-2"></i> ${data.title}`;
            document.getElementById('modal-desc').innerHTML = data.desc;
            document.getElementById('modal-analysis').innerHTML = data.analysis;
            document.getElementById('modal-ref').innerHTML = data.cite;
            document.getElementById('ref-modal').classList.add('open');
        }
        function closeModal() { document.getElementById('ref-modal').classList.remove('open'); }

        // --- INIT FUNCTIONS ---
        function initDeepLens() {
            const container = document.getElementById('lens-network-container');
            if(lensNetwork) { lensNetwork.destroy(); lensNetwork = null; }
            const nodes = new vis.DataSet([
                { id: 'Fact', label: 'äº‹å¯¦\nFact', color: '#cbd5e1', shape: 'circle', widthConstraint: { minimum: 60 } },
                { id: 'Theory', label: 'ç†è«–\nTheory', color: '#3b82f6', shape: 'circle', font: {color:'white'}, widthConstraint: { minimum: 80 } },
                { id: 'Challenge', label: 'æŒ‘æˆ°\nChallenge', color: '#eab308', shape: 'circle', font: {color:'white'}, widthConstraint: { minimum: 70 } },
                { id: 'Synthesis', label: 'æ•´åˆ\nSynthesis', color: '#22c55e', shape: 'circle', font: {color:'white'}, widthConstraint: { minimum: 60 } }
            ]);
            const edges = new vis.DataSet([
                { id: 'e1', from: 'Fact', to: 'Theory', width: 6, arrows: 'to' }, { id: 'e2', from: 'Theory', to: 'Challenge', width: 4, arrows: 'to' },
                { id: 'e3', from: 'Challenge', to: 'Synthesis', width: 3, arrows: 'to' }, { id: 'e4', from: 'Theory', to: 'Theory', width: 2, arrows: 'to', dashes: true },
                { id: 'e5', from: 'Theory', to: 'Synthesis', width: 2, arrows: 'to' }
            ]);
            lensNetwork = new vis.Network(container, { nodes, edges }, {
                nodes: { font: { face: 'Noto Sans TC', size: 14 }, borderWidth: 2, shadow: true },
                edges: { color: { color: '#94a3b8', highlight: '#1e40af' }, smooth: { type: 'curvedCW', roundness: 0.2 } },
                physics: { stabilization: true }, interaction: { hover: true, zoomView: false }
            });
            lensNetwork.on("click", function (params) {
                const detailBox = document.getElementById('lens-detail');
                let info = null;
                if (params.nodes.length > 0) info = lensInteractions[params.nodes[0]];
                else if (params.edges.length > 0) {
                    const edgeObj = edges.get(params.edges[0]);
                    info = lensInteractions[`${edgeObj.from}->${edgeObj.to}`];
                }
                if (info) detailBox.innerHTML = `<div class="lens-detail-title text-slate-700">${info.title}</div><p class="text-slate-600">${info.text}</p><div class="example-quote"><div class="example-author">å­¸ç”Ÿå¯¦ä¾‹ (Student Voices)ï¼š</div>${info.example || "æš«ç„¡ç¯„ä¾‹"}</div>`;
            });
            setTimeout(() => lensNetwork.fit(), 100);
        }

        function initStreamChart() {
            const ctx = document.getElementById('streamChart').getContext('2d');
            if (streamChart) streamChart.destroy();
            streamChart = new Chart(ctx, {
                type: 'line', data: { labels: ['W1', 'W2', 'W3', 'W4', 'W5'], datasets: [{ label: 'æ•´åˆ', data: [5, 10, 15, 30, 55], backgroundColor: 'rgba(34, 197, 94, 0.6)', borderColor: 'rgba(34, 197, 94, 1)', fill: true, tension: 0.4, pointRadius: 0 }, { label: 'æŒ‘æˆ°', data: [10, 20, 45, 35, 25], backgroundColor: 'rgba(234, 179, 8, 0.6)', borderColor: 'rgba(234, 179, 8, 1)', fill: true, tension: 0.4, pointRadius: 0 }, { label: 'ç†è«–', data: [25, 45, 50, 40, 30], backgroundColor: 'rgba(59, 130, 246, 0.6)', borderColor: 'rgba(59, 130, 246, 1)', fill: true, tension: 0.4, pointRadius: 0 }, { label: 'äº‹å¯¦', data: [70, 50, 30, 25, 20], backgroundColor: 'rgba(203, 213, 225, 0.6)', borderColor: 'rgba(203, 213, 225, 1)', fill: true, tension: 0.4, pointRadius: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { family: 'Noto Sans TC', size: 10 } } } }, scales: { x: { display: true }, y: { display: false, beginAtZero: true } } }
            });
        }

        function initConceptNetwork() {
            const container = document.getElementById('concept-network-container');
            if (conceptNetworkInstance) { conceptNetworkInstance.destroy(); conceptNetworkInstance = null; }
            const nodes = new vis.DataSet([{ id: 1, label: 'å…‰åˆä½œç”¨', value: 20, color: '#3b82f6', font: {color:'white'} },{ id: 2, label: 'èƒ½é‡', value: 15, color: '#60a5fa' },{ id: 3, label: 'è‘‰ç¶ ç´ ', value: 12, color: '#93c5fd' },{ id: 4, label: 'é™½å…‰', value: 10, color: '#93c5fd' },{ id: 5, label: 'å‘¼å¸ä½œç”¨', value: 8, color: '#cbd5e1' }]);
            const edges = new vis.DataSet([{ from: 1, to: 2, value: 5 }, { from: 1, to: 3, value: 4 }, { from: 1, to: 4, value: 4 },{ from: 2, to: 4, value: 3 }]);
            conceptNetworkInstance = new vis.Network(container, { nodes, edges }, { nodes: { shape: 'dot', font: { face: 'Noto Sans TC' } }, physics: { stabilization: true }, interaction: { zoomView: false } });
            setTimeout(() => conceptNetworkInstance.fit(), 100);
        }

        function initLexicalChart() {
            const ctx = document.getElementById('lexicalChart').getContext('2d');
            if (lexicalChartInstance) lexicalChartInstance.destroy();
            lexicalChartInstance = new Chart(ctx, { type: 'line', data: { labels: ['W1', 'W2', 'W3', 'W4', 'W5'], datasets: [{ label: 'ç¨ç‰¹å­¸è¡“è©å½™æ•¸', data: [5, 12, 18, 40, 48], borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } } });
        }

        function initOverview() {
            const container = document.getElementById('overview-network-container');
            if(overviewNetwork) { overviewNetwork.destroy(); overviewNetwork = null; }
            const nodes = new vis.DataSet([{id:1,label:'å°æ˜',color:'#3b82f6',value:10, shape:'dot'},{id:2,label:'ç¾è‰',color:'#ef4444',value:5, shape:'dot'},{id:3,label:'å¤§æ–‡',color:'#3b82f6',value:15, shape:'dot'}]);
            const edges = new vis.DataSet([{from:1,to:3},{from:3,to:1},{from:2,to:3}]);
            overviewNetwork = new vis.Network(container, { nodes, edges }, { nodes: { font: { face: 'Noto Sans TC' } }, physics: { stabilization: true } });
            
            const ctx = document.getElementById('principlesChart').getContext('2d');
            if(principlesChartInstance) principlesChartInstance.destroy();
            principlesChartInstance = new Chart(ctx, { type: 'radar', data: { labels: ['è§€é»å¤šæ¨£æ€§', 'é›†é«”è²¬ä»»', 'çœŸå¯¦å•é¡Œ', 'æ¬Šå¨è³‡æ–™', 'è§€é»æ”¹é€²', 'æ°‘ä¸»åŒ–'], datasets: [{ label: 'æœ¬ç­ç¾æ³', data: [85, 70, 80, 40, 75, 90], backgroundColor: 'rgba(99, 102, 241, 0.2)', borderColor: '#6366f1' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 100 } } } });
            setTimeout(() => overviewNetwork.fit(), 100);
        }

        function loadStudentData(id) {
            const data = {
                'S001': { name:'å¼µå°æ˜', role:'è§€é»æ©‹æ¨‘è€…', radar:[60,90,85,40,70], depth:{theory:[2,5,12,18,22],fact:[10,8,5,4,3]}, badges:['è§€é»æ©‹æ¨‘è€…','æˆé•·é¡¯è‘—'], egoNodes:[{id:1,label:'å°æ˜',color:'#3b82f6',size:20, shape:'dot'},{id:2,label:'å¤§æ–‡',size:15, shape:'dot'},{id:3,label:'ç¾è‰',size:10, shape:'dot'}], egoEdges:[{from:1,to:2},{from:1,to:3}], metric:'é€£çµæ•¸: 4äºº (é–‹æ”¾å‹)', suggestions:['è‚¯å®šç†è«–å»ºæ§‹','æŒ‡æ´¾æ•´åˆä»»å‹™'], notes:25 },
                'S002': { name:'æç¾è‰', role:'è§€å¯Ÿè€…', radar:[80,20,40,10,30], depth:{theory:[1,2,2,3,2],fact:[8,9,7,8,6]}, badges:['è§€å¯Ÿè€…','éœ€é—œæ³¨'], egoNodes:[{id:1,label:'ç¾è‰',color:'#ef4444',size:20, shape:'dot'},{id:2,label:'è€å¸«',size:15, shape:'dot'}], egoEdges:[{from:1,to:2}], metric:'é€£çµæ•¸: 2äºº (ä¾è³´å‹)', suggestions:['ä½¿ç”¨ My Theory','æ¸›å°‘ä¾è³´'], notes:12 }
            }[id];
            
            document.querySelectorAll('.student-item').forEach(el => el.classList.remove('active-student', 'bg-indigo-50', 'border-indigo-200'));
            const btn = document.getElementById(`student-btn-${id}`);
            if(btn) btn.classList.add('active-student', 'bg-indigo-50', 'border-indigo-200');
            
            document.getElementById('profile-name').innerText = data.name;
            document.getElementById('profile-id').innerText = id;
            document.getElementById('profile-notes-count').innerText = data.notes;
            document.getElementById('profile-avatar').innerText = data.name[0];
            document.getElementById('profile-status-text').innerText = data.role + " - ç‹€æ…‹åˆ†æå®Œæˆ";
            document.getElementById('profile-badges').innerHTML = data.badges.map(b => `<span class="kb-badge bg-blue-100 text-blue-700 mr-1">${b}</span>`).join('');
            document.getElementById('ego-metric').innerText = data.metric;
            document.getElementById('ai-suggestions').innerHTML = data.suggestions.map(s => `<div class="flex gap-2"><i class="fas fa-check text-green-500 mt-1"></i><div class="text-sm">${s}</div></div>`).join('');

            const ctxR = document.getElementById('radarChart').getContext('2d');
            if(radarChartInstance) radarChartInstance.destroy();
            radarChartInstance = new Chart(ctxR, { type: 'radar', data: { labels: ['ç™¼èµ·','ç†è«–','å›æ‡‰','æ•´åˆ','è©å½™'], datasets: [{label: data.name, data: data.radar, backgroundColor:'rgba(59,130,246,0.2)', borderColor:'#3B82F6'}] }, options: { responsive:true, maintainAspectRatio:false, scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks:{display:false} } }, plugins:{legend:{display:false}} } });

            const ctxD = document.getElementById('studentDepthChart').getContext('2d');
            if(studentDepthChartInstance) studentDepthChartInstance.destroy();
            studentDepthChartInstance = new Chart(ctxD, { type: 'line', data: { labels: ['W1','W2','W3','W4','W5'], datasets: [{label:'ç†è«–', data:data.depth.theory, borderColor:'#3B82F6', tension:0.2}, {label:'äº‹å¯¦', data:data.depth.fact, borderColor:'#CBD5E1', borderDash:[5,5], tension:0.2}] }, options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} } });

            const container = document.getElementById('ego-network-container');
            if(egoNetworkInstance) { egoNetworkInstance.destroy(); egoNetworkInstance = null; }
            const nodes = new vis.DataSet(data.egoNodes);
            const edges = new vis.DataSet(data.egoEdges);
            setTimeout(() => {
                egoNetworkInstance = new vis.Network(container, { nodes, edges }, { nodes: { font: { face: 'Noto Sans TC' } }, physics: { stabilization: true }, interaction: { zoomView: false } });
                egoNetworkInstance.fit();
            }, 100);
        }

        function switchView(viewName) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('active', 'bg-slate-900', 'border-l-4', 'border-blue-500'); el.classList.add('text-slate-400'); });
            const activeNav = document.getElementById('nav-' + viewName);
            activeNav.classList.add('active', 'bg-slate-900', 'text-white', 'border-l-4', 'border-blue-500');
            activeNav.classList.remove('text-slate-400');

            if (viewName === 'quality') setTimeout(() => { initDeepLens(); initStreamChart(); }, 100);
            else if (viewName === 'overview') setTimeout(initOverview, 100);
            else if (viewName === 'topics') setTimeout(() => { initConceptNetwork(); initLexicalChart(); }, 100);
            else if (viewName === 'students') {
                const id = document.querySelector('.active-student') ? document.querySelector('.active-student').id.replace('student-btn-', '') : 'S001';
                loadStudentData(id);
            }
        }

        window.onload = function() { switchView('overview'); };
    </script>
</body>
</html>