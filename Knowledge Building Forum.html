<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>知識建構協作平台 (KB Platform) - AI Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Noto Sans TC', 'sans-serif'] },
                    colors: { kb: { blue: '#3b82f6', yellow: '#eab308', green: '#22c55e', red: '#ef4444', purple: '#a855f7' } },
                    animation: { 'bounce-slow': 'bounce 3s infinite' }
                }
            }
        }
    </script>
    <style>
        body { overflow: hidden; overscroll-behavior: none; }
        #canvas-bg { background-color: #f8fafc; background-image: radial-gradient(#cbd5e1 1px, transparent 1px); background-size: 20px 20px; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: -1; }
        .node-card { transition: box-shadow 0.2s, transform 0.2s; user-select: none; touch-action: none; -webkit-user-select: none; will-change: left, top; }
        .node-card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 50; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col font-sans">

    <!-- Top Navbar -->
    <nav class="h-14 md:h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 md:px-6 z-50 shadow-sm relative shrink-0">
        <!-- 修改處：Logo 點擊返回 index.html -->
        <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='index.html'">
            <div class="w-8 h-8 md:w-10 md:h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg md:text-xl shrink-0">KB</div>
            <div>
                <h1 class="font-bold text-base md:text-lg leading-tight text-slate-800 truncate">知識建構平台</h1>
                <p class="text-[10px] md:text-xs text-slate-500 hidden md:block">Knowledge Building Environment</p>
            </div>
        </div>
        
        <div class="hidden md:flex items-center bg-slate-100 p-1 rounded-lg">
            <!-- 修改處：新增返回首頁按鈕 -->
            <button onclick="location.href='index.html'" class="px-4 py-1.5 text-sm font-bold rounded-md text-indigo-600 hover:bg-white transition flex items-center gap-2">
                <i class="fa-solid fa-house"></i> 返回首頁
            </button>
            <div class="h-4 w-px bg-slate-300 mx-2"></div>
            <button onclick="window.app.router('entrance')" data-nav="entrance" class="nav-btn px-4 py-1.5 text-sm font-medium rounded-md text-slate-500 hover:text-slate-900 transition">主題入口</button>
            <button onclick="window.app.router('canvas')" data-nav="canvas" class="nav-btn px-4 py-1.5 text-sm font-medium rounded-md text-slate-500 hover:text-slate-900 transition">知識地圖</button>
            <button onclick="window.app.router('profile')" data-nav="profile" class="nav-btn px-4 py-1.5 text-sm font-medium rounded-md text-slate-500 hover:text-slate-900 transition">我的檔案</button>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <div id="ai-persona-indicator" class="hidden md:flex items-center gap-2 px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-medium border border-indigo-100">
                <i class="fa-solid fa-robot animate-pulse"></i>
                <span>AI 助手已就緒</span>
            </div>
            <div class="flex items-center gap-2 group relative">
                <img id="user-avatar" src="https://api.dicebear.com/9.x/notionists/svg?seed=Felix" class="w-8 h-8 rounded-full bg-slate-200 border border-slate-300 shrink-0">
                <button onclick="window.app.toggleUserMenu()" class="ml-1 text-slate-400 hover:text-indigo-600 p-1"><i class="fa-solid fa-chevron-down text-xs"></i></button>
                <div id="user-menu" class="absolute top-full right-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-slate-100 hidden z-[100]"></div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main id="app-container" class="flex-1 relative overflow-hidden bg-slate-50 w-full mb-14 md:mb-0"></main>

    <!-- Mobile Bottom Navigation -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 h-14 bg-white border-t border-slate-200 flex justify-around items-center z-50 pb-safe">
        <!-- 修改處：手機版第一個按鈕改為返回 index.html -->
        <button onclick="location.href='index.html'" class="flex flex-col items-center justify-center w-full h-full text-indigo-600 font-bold">
            <i class="fa-solid fa-house text-lg mb-0.5"></i>
            <span class="text-[10px]">首頁</span>
        </button>
        <button onclick="window.app.router('entrance')" class="flex flex-col items-center justify-center w-full h-full text-slate-400">
            <i class="fa-solid fa-folder text-lg mb-0.5"></i>
            <span class="text-[10px]">主題</span>
        </button>
        <button onclick="window.app.router('canvas')" class="flex flex-col items-center justify-center w-full h-full text-slate-400">
            <i class="fa-solid fa-project-diagram text-lg mb-0.5"></i>
            <span class="text-[10px]">地圖</span>
        </button>
        <button onclick="window.app.router('profile')" class="flex flex-col items-center justify-center w-full h-full text-slate-400">
            <i class="fa-solid fa-user text-lg mb-0.5"></i>
            <span class="text-[10px]">檔案</span>
        </button>
    </div>

    <script>
        // 這裡保留原有的 script 邏輯，僅需確保 router 與 API 功能正常。
        // ... (省略部分不變的邏輯以節省空間)
        window.app = {
            router: (view) => {
                // 原有的 router 邏輯
                window.ui.renderEntrance(); // 範例
            }
        };
        // 初始載入渲染
        window.onload = () => { window.app.router('entrance'); };
    </script>
</body>
</html>
